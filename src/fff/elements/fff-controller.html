<link rel="import" href="./fff-file-tree.html">
<link rel="import" href="./fff-frame.html">
<link rel="import" href="./fff-layout.html">

<dom-module id="fff-controller">
  <template>
    <div>
      <template is="dom-if" if="[[_isVisible(view, toggled)]]" restamp="true">
        <fff-layout docking-style="[[dockingStyle]]">
          <fff-frame docking-style="{{dockingStyle}}" toggled="{{toggled}}">
            <fff-file-tree files="[[files]]" />
          </fff-frame>
        </fff-layout>
      </template>
    </div>
  </template>

  <script>
    Polymer({
      is: 'fff-controller',

      behaviors: [
        Gerrit.KeyboardShortcutBehavior
      ],

      keyBindings: {
        'f': '_toggle',
      },


      properties: {
        files: Array,

        keyEventTarget: {
          type: Object,
          value: function() {
            return document.body;
          }
        },

        dockingStyle: {
          type: String,
          value: 'side',
        },

        toggled: {
          type: Boolean,
          value: false
        },

        view: {
          type: String,
          observer: '_resetToggledStateOnLeave'
        }
      },

      attached() {
        if (location.search.includes('fff=1')) {
          this.set('toggled', true)
        }

        if (location.search.match('fff-docking-style=(side|overlay)')) {
          this.set('dockingStyle', RegExp.$1)
        }
      },

      _isVisible(view, toggled) {
        return toggled && this._isApplicableView(view)
      },

      _isApplicableView(view) {
        return ['change', 'diff'].indexOf(view) > -1
      },

      _toggle(e) {
        this.set('toggled', !this.toggled)
      },

      _resetToggledStateOnLeave(view) {
        if (!this._isApplicableView(view)) {
          this.set('toggled', false)
        }
      }
    })
  </script>
</dom-module>
